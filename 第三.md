# 第三章 基于双路径解耦的遥感图像语义分割方法

遥感图像语义分割是遥感图像智能解译中的核心任务，其目标是将图像中的每个像素分配至对应的地物类别，从而实现对地表覆盖信息的精确提取与定量分析。这一技术在城市规划、环境监测、灾害评估等领域具有广泛的应用价值。高分辨率遥感图像具有地物类型丰富、目标尺度差异显著、背景环境复杂等特点，这对分割模型同时提出了全局上下文建模能力与局部细节捕获能力的双重要求。然而，现有基于状态空间模型的分割方法普遍采用单路径的序列化处理架构，将上述两种本质不同的子任务耦合于同一计算流程中，导致优化过程中出现目标冲突。此外，在多阶段特征处理中，通道-空间注意力的同质化重复施加也引入了不必要的计算冗余。

针对上述问题，本章提出了一种基于双路径解耦思想的遥感图像语义分割网络DP-UNet，核心设计遵循"解耦"与"精简"两大原则。首先，在解码器中设计了双路径解耦状态空间模块（Dual-path VSS, DVSS），将全局上下文建模与局部细节增强分离为两条独立的专用路径，使各子任务获得充分的优化空间；其次，在多尺度特征融合阶段，提出了轻量级的多尺度空间核模块（Multi-Scale Kernel, MSK），以纯空间注意力取代冗余的通道-空间双重注意力，在保持融合效果的同时显著降低了计算开销。

## 3.1 现有方法的问题分析

在深入阐述本章所提方法之前，有必要对遥感图像分割中现有方法所面临的共性问题进行系统分析。本节从全局-局部建模的耦合瓶颈和注意力机制的冗余施加两个角度展开讨论，揭示制约当前方法性能进一步提升的关键因素。

### 3.1.1 全局-局部建模的耦合瓶颈

遥感图像语义分割本质上需要模型同时完成两个层面的推理任务：一是全局上下文建模，即在较大空间范围内整合语义信息，识别地物类别的宏观分布模式，确保同类地物在不同空间位置的分类一致性；二是局部细节增强，即在精细空间尺度上保留并强化边缘轮廓、纹理特征等高频信息，确保地物边界的准确描绘和小目标的有效识别。这两个任务虽然作用于同一输入特征，但其优化目标存在内在差异——前者追求特征的平滑性和语义一致性，后者追求特征的锐利性和空间精确性。

以基于状态空间模型的分割网络为例，当前主流方法普遍采用单路径的序列化设计。以CM-UNet中的CSMamba模块为代表，其核心SS2D组件通过四方向二维状态空间扫描实现全局上下文建模，同时在扫描路径中嵌入通道注意力与空间注意力门控以增强特征选择能力。然而，这种设计将全局语义聚合与局部细节增强共享同一组网络参数和计算路径。在训练过程中，梯度信号同时承载着两种子任务的优化需求，使得网络参数被迫在两种目标之间进行折衷，难以在任一方面达到最优。

为了更直观地理解这一耦合效应的影响，图3-1展示了在遥感分割场景中典型的失败案例。在包含多尺度地物目标的图像区域中，单路径架构的模型往往表现出两类典型的误分割模式：一类是在大尺度地物内部出现不一致的分类结果，表明全局上下文建模不充分；另一类是在地物边界处出现模糊或锯齿状的分割结果，表明局部细节信息在处理过程中受到了全局平滑化操作的损害。

**图3-1 单路径架构在遥感分割中的典型失败案例（a）原始遥感图像；（b）真实标签；（c）单路径方法的分割结果；（d）本章方法的分割结果**

上述分析表明，全局上下文建模与局部细节增强之间的耦合是限制当前方法性能提升的一个关键瓶颈。将这两个具有不同优化目标的子任务进行显式解耦，使之在独立的路径中接受专门的优化，是突破这一性能瓶颈的可行策略。

### 3.1.2 注意力机制的冗余施加

注意力机制已成为现代深度网络中增强特征表达能力的标准手段。在遥感分割任务中，通道注意力和空间注意力分别从特征通道间依赖建模和空间位置间关联建模两个维度提升特征的判别力，被广泛应用于网络的各个阶段。然而，当注意力模块在网络中被不加区分地重复施加时，其边际收益将迅速递减，而带来的参数量和计算量增长却是线性累积的。

具体而言，现有方法中注意力冗余主要体现在两个层面。第一个层面是模块内部的注意力冗余。以CM-UNet的CSMamba模块为例，其内部SS2D组件已经嵌入了通道注意力门控和空间注意力门控，用于在状态空间扫描过程中对特征进行自适应选择。这些注意力门控与SS2D的扫描操作紧密耦合，形成了一套完整的特征选择机制。第二个层面是跨模块的注意力冗余。在特征融合阶段，MSAA模块再次引入了通道注意力和空间注意力的完整组合，对来自编码器的跳跃连接特征进行重新加权。由于SS2D内部的注意力门控已经完成了一次通道-空间维度的特征筛选，MSAA中相似的注意力操作在很大程度上重复了SS2D的工作，造成了同质化的注意力堆叠。

这种双重冗余的直接后果是计算效率的不必要降低。更深层的问题在于，多级同质注意力的叠加可能导致注意力权重的过度聚焦现象：每一级注意力都倾向于增强已经被前一级强化的特征响应，抑制已经被弱化的特征信号，使得最终的特征表示过度集中于少数显著区域，反而降低了网络对弱响应但语义重要的特征的捕获能力。

图3-2直观展示了注意力冗余对网络特征表示的影响。通过可视化不同阶段的注意力权重分布，可以观察到冗余注意力施加后特征响应的过度集中现象，以及去除冗余后特征分布更加均衡合理的效果。

**图3-2 注意力冗余现象的可视化分析（a）SS2D内部注意力权重分布；（b）MSAA注意力权重分布；（c）冗余注意力叠加后的特征响应；（d）精简注意力后的特征响应**

基于上述分析，本章主张在网络设计中应遵循"专注分工、各司其职"的注意力部署策略：在解码器的核心处理模块中，将注意力集中用于通道维度的特征重标定，辅助局部细节增强路径的精准聚焦；在多尺度特征融合阶段，则专注于空间维度的注意力建模，以弥合不同尺度特征图之间的空间对齐差异。通过这种有针对性的注意力配置，避免同质注意力的重复施加，在保持甚至提升模型性能的同时，显著改善计算效率。

## 3.2 DP-UNet整体架构

基于上一节的分析，本节提出了一种面向遥感图像语义分割的编码器-解码器网络DP-UNet，其整体架构如图3-3所示。该网络由三个核心组件构成：基于ResNet-18的多层级特征提取编码器、基于MSK模块的多尺度特征融合机制，以及基于DVSS模块的渐进式上采样解码器。

**图3-3 DP-UNet整体网络架构（a）网络全局结构，红色箭头表示上采样，蓝色箭头表示下采样；（b）DVSS模块的内部结构**

### 3.2.1 编码器

编码器采用在ImageNet上预训练的ResNet-18作为骨干网络，负责从输入图像中提取多层级的视觉特征。给定输入图像$I \in \mathbb{R}^{H \times W \times 3}$，编码器输出四个不同分辨率的特征图$\{F_1, F_2, F_3, F_4\}$，其空间分辨率分别为原始图像的$1/4$、$1/8$、$1/16$和$1/32$，对应的通道数分别为64、128、256和512。

选择ResNet-18而非更深层的网络作为编码器骨干，基于以下考量：首先，ResNet-18的残差连接结构能够有效缓解梯度消失问题，保证多层级特征的有效提取；其次，其较为紧凑的参数规模与本章追求的高效计算目标一致；最后，浅层网络提取的特征保留了更丰富的空间细节信息，有利于后续解码器中局部细节增强路径的有效工作。编码过程可形式化表示为：

$$\{F_1, F_2, F_3, F_4\} = \text{Enc}(I) \tag{3-1}$$

其中$\text{Enc}(\cdot)$表示编码器的特征提取操作。

### 3.2.2 多尺度特征融合

编码器输出的前三层特征$\{F_1, F_2, F_3\}$通过三个MSK模块进行跨尺度融合，生成增强后的跳跃连接特征$\{F_1', F_2', F_3'\}$；最深层特征$F_4$则直接传入解码器。每个MSK模块以三层编码器特征作为输入，将其中两层的特征图通过双线性插值调整至目标分辨率后，与目标层特征进行拼接融合。该融合过程可表示为：

$$F_i' = \text{MSK}_i(F_1, F_2, F_3), \quad i = 1, 2, 3 \tag{3-2}$$

其中$\text{MSK}_i$表示第$i$个MSK模块，其将来自其他两个尺度的特征调整至目标尺度后进行融合处理。MSK模块的详细设计将在3.4节中进行阐述。

### 3.2.3 解码器

解码器采用渐进式上采样策略，由四个DVSS模块组成。解码阶段0直接处理最深层特征$F_4$，随后的解码阶段1至3依次将上采样后的深层特征与对应的增强跳跃连接特征进行融合，并通过DVSS模块进行进一步处理。具体而言，每个解码阶段首先对前一阶段的输出进行双线性上采样，与对应层级的增强跳跃特征进行通道拼接，再通过1×1逐点卷积进行通道降维，最后输入DVSS模块进行全局-局部双路径处理。该过程可表示为：

$$D_4 = \text{DVSS}_4(F_4) \tag{3-3}$$

$$D_i = \text{DVSS}_i(\text{Proj}(\text{Up}(D_{i+1})), F_i'), \quad i = 3, 2, 1 \tag{3-4}$$

其中$\text{Proj}(\cdot)$表示逐点卷积投影操作，用于通道数的调整；$\text{Up}(\cdot)$表示双线性上采样操作。DVSS模块的详细设计将在3.3节中进行阐述。

### 3.2.4 预测头与损失函数

解码器最终阶段的输出$D_1$通过一个$1 \times 1$卷积头生成预测结果，再经双线性上采样恢复至原始分辨率，获得最终的分割预测图$P$。此外，为了强化深层解码器的学习信号，在解码阶段2至4设置辅助预测头，提供深度监督。最终的训练损失函数定义为：

$$P = \text{Head}(D_1) \tag{3-5}$$

$$\mathcal{L} = \mathcal{J}(P, Y) + \lambda \sum_{i=2}^{4} \mathcal{J}(P_i, Y) \tag{3-6}$$

其中$Y$为真实标签，$P_i$为第$i$个解码阶段的辅助预测，$\mathcal{J}(\cdot)$为交叉熵损失与Dice损失的联合损失函数，$\lambda = 0.4$为辅助损失的权重系数。

联合损失函数的设计动机在于：交叉熵损失擅长于像素级分类的全局优化，为模型提供稳定且均衡的梯度信号；Dice损失则直接优化分割区域的重叠度，对类别不平衡具有天然的鲁棒性，尤其有利于遥感图像中面积较小的地物类别（如车辆）的学习。两者的结合使模型在全局分类精度和区域分割质量之间取得平衡。深度监督策略通过在中间解码层施加额外的监督信号，促使网络在不同抽象层级上都学习到有意义的语义表示，有效缓解了深层网络中梯度衰减的问题，加速了模型收敛。

## 3.3 双路径解耦状态空间模块（DVSS）

本节详细介绍作为DP-UNet解码器核心的双路径解耦状态空间模块（DVSS）。该模块的设计理念是将全局上下文建模与局部细节增强从共享参数的单一路径中解放出来，为每个子任务建立独立的专用处理路径，并通过自适应门控机制实现两条路径输出的有效融合。

### 3.3.1 共享基底与路径分离

DVSS模块的整体工作流程如图3-4所示。给定输入特征$X \in \mathbb{R}^{B \times H \times W \times C}$，首先经过层归一化处理，然后输入SS2D模块。SS2D模块采用四方向二维状态空间扫描机制，将二维特征图沿四个方向（从左到右、从右到左、从上到下、从下到上）展开为一维序列，分别进行状态空间建模后合并，从而在保持线性计算复杂度的同时捕获全局范围的特征依赖关系。

与现有方法不同的是，本章对SS2D模块进行了精简化处理，移除了其内部原有的通道注意力门控和空间注意力门控。这一设计决策基于3.1.2节的分析：SS2D的状态空间扫描本身已经具备全局上下文建模能力，内部注意力门控的移除不仅消除了与后续模块之间的注意力冗余，还为DVSS中专门设计的局部路径注意力机制腾出了"注意力预算"。精简后的SS2D输出作为共享基底特征$F_s$，同时送入全局路径和局部路径：

$$F_s = \text{SS2D}(\text{LN}(X)) \tag{3-7}$$

其中$\text{LN}(\cdot)$表示层归一化操作。这种"共享基底、分支增强"的设计确保了两条路径基于相同的特征基础进行各自的专门化处理，既避免了独立编码带来的信息冗余，又保证了路径间的特征一致性。

**图3-4 DVSS模块的内部结构示意图。输入特征经SS2D处理后形成共享基底特征，随后分别进入全局路径和局部路径进行专门化处理，最终通过APFG模块进行自适应融合**

### 3.3.2 全局上下文路径

全局路径的设计遵循简洁有效的原则，直接保留共享基底特征$F_s$作为全局路径的输出$F_g$：

$$F_g = F_s \tag{3-8}$$

这一设计看似简单，实则蕴含着重要的方法论考量。SS2D模块通过四方向状态空间扫描已经完成了全局范围的上下文建模，其输出特征$F_s$天然地编码了全局语义信息。对这些特征施加额外的变换操作不仅增加计算负担，还可能引入不必要的信息损耗。因此，全局路径的核心思想是信任并保护SS2D所建立的全局上下文表示，将计算资源集中分配给更需要专门化处理的局部细节增强任务。这种非对称的计算资源分配策略体现了本章"精简"设计原则的核心思想。

### 3.3.3 局部细节增强路径

局部路径是DVSS模块的核心创新所在，由高效通道注意力（ECA）模块和参数域调制卷积（PMC）模块两个关键组件串联构成，旨在从共享基底特征中挖掘并强化局部空间细节信息。

**（1）通道重标定：高效通道注意力模块**

局部路径的第一步是对共享基底特征$F_s$进行通道维度的自适应重标定。这一步骤的动机在于：$F_s$中的不同通道编码了不同类型和不同层级的视觉信息，对于局部细节提取而言，并非所有通道同等重要。通过通道注意力机制，可以自适应地增强与边缘、纹理等高频信息相关的通道响应，抑制与全局语义信息相关但对局部细节增强贡献较小的通道响应，从而为后续的PMC模块提供经过信息筛选的输入。

本章采用高效通道注意力（Efficient Channel Attention, ECA）模块实现通道重标定。ECA模块如图3-5所示，其通过全局平均池化获取各通道的全局统计信息，然后利用一维卷积在相邻通道间建模局部跨通道依赖关系，避免了传统SE模块中全连接层带来的通道信息压缩损失和较大的参数开销。ECA模块的计算过程可以表示为：

$$y_c = \text{GAP}(F_s^c) = \frac{1}{H \times W} \sum_{i=1}^{H} \sum_{j=1}^{W} F_s^c(i, j) \tag{3-9}$$

$$\omega = \sigma(\text{Conv1D}_k(\mathbf{y})) \tag{3-10}$$

$$F_{eca} = \omega \odot F_s \tag{3-11}$$

其中$\text{GAP}(\cdot)$表示全局平均池化操作，$\mathbf{y} \in \mathbb{R}^C$为各通道的全局描述向量，$\text{Conv1D}_k(\cdot)$为核大小为$k$的一维卷积操作，$\sigma(\cdot)$为Sigmoid激活函数，$\odot$表示逐元素乘法（即通道级别的特征缩放）。一维卷积核大小$k$通过通道数$C$自适应确定：

$$k = \left| \frac{\log_2 C}{\gamma} + \frac{b}{\gamma} \right|_{\text{odd}} \tag{3-12}$$

其中$\gamma = 2$，$b = 1$，$|\cdot|_{\text{odd}}$表示取最近的奇数。

经通道重标定后的特征$F_{eca}$通过与原始基底特征$F_s$的残差连接进行增强，确保原始信息的完整传递：

$$F_{eca}' = F_{eca} + F_s \tag{3-13}$$

**图3-5 ECA模块的结构示意图**

**（2）参数域调制卷积（PMC）**

经过通道重标定后的特征$F_{eca}'$被送入参数域调制卷积（Parameterized Modulation Convolution, PMC）模块进行局部空间细节的精细化增强。PMC模块的提出源于对标准卷积行为的深入分析。

在标准卷积运算中，卷积核的中心位置始终与输入特征图的目标采样位置精确对齐，无论输入特征的空间内容如何变化。这种固定的空间对应关系使得中心权重在训练过程中始终处于最稳定的梯度更新条件下：中心位置的采样在所有空间位置上具有最高的对齐一致性，且在滑动窗口的重叠区域中被最频繁地激活，因此累积接收到的梯度信号最为稳定且幅度最大。经过长期训练，这一过程导致了显著的中心权重主导现象——卷积核中心位置的权重幅值远大于周围位置。

中心主导效应意味着标准卷积的输出在很大程度上由中心位置的输入值决定，而来自周围邻域的信息贡献相对较弱。对于全局语义理解任务而言，这种中心聚焦的行为或许是可接受的；但对于局部细节增强任务，特别是边缘检测、纹理提取等需要充分利用邻域差异信息的场景，中心主导效应恰恰削弱了卷积核对边缘方向性和纹理周期性等局部空间模式的敏感度。

PMC模块的核心思想是在参数域（而非空间域）引入一种可学习的抑制性先验，自适应地调制卷积核权重，抑制中心权重的绝对主导地位，促使网络更均衡地利用邻域信息。与传统的可变形卷积在空间域通过学习采样偏移量来改变感受野形状不同，PMC将调制操作转移至参数域，避免了坐标偏移计算和双线性插值等复杂操作，在保持轻量级计算开销的同时实现了对卷积行为的有效调制。

PMC模块的具体计算过程如图3-6所示。设标准卷积核的权重张量为$W \in \mathbb{R}^{C_{out} \times C_{in} \times k_h \times k_w}$，PMC通过以下步骤生成调制后的有效卷积权重$W_{eff}$：

**步骤一：通道强度矩阵的计算。** 将权重张量$W$沿空间维度求和，生成通道强度矩阵$S \in \mathbb{R}^{C_{out} \times C_{in}}$，表征每对输入-输出通道之间的连接强度：

$$S = \sum_{i=1}^{k_h} \sum_{j=1}^{k_w} W(:, :, i, j) \tag{3-14}$$

**步骤二：动态抑制掩码的生成。** 动态掩码$M_d$由三个分量的逐元素乘积构成：可学习掩码矩阵$W_m \in \mathbb{R}^{C_{out} \times C_{in}}$、固定中心掩码$M_c$（仅卷积核中心位置为1，其余位置为0）和通道强度矩阵$S$：

$$M_d = W_m \odot M_c \odot S \tag{3-15}$$

其中$M_c$的引入确保了抑制操作仅作用于卷积核的中心位置，而$W_m$和$S$的参与则使得抑制强度能够根据每对通道的实际连接强度和任务需求进行自适应调整。

**步骤三：权重调制。** 引入可学习缩放因子$\theta$，对原始卷积权重进行调制：

$$W_{eff} = W \odot (\mathbf{1} - \theta \times M_d) \tag{3-16}$$

其中$\mathbf{1}$为与$W$同形状的全1张量。当$\theta \times M_d$在中心位置取正值时，该位置的权重将被适度抑制；$\theta$的可学习性使得网络能够自主控制抑制的全局强度，在中心抑制带来的邻域信息增益与中心信息保留之间寻找最优平衡。

最终，使用调制后的有效权重$W_{eff}$对输入特征$F_{eca}'$进行卷积运算，得到局部路径的输出$F_l$：

$$F_l = \text{Conv}_{W_{eff}}(F_{eca}') \tag{3-17}$$

**图3-6 PMC模块的工作流程示意图。标准卷积权重通过通道强度矩阵和动态掩码在参数域进行自适应调制，抑制中心主导效应**

与传统可变形卷积（如LDC）的对比分析进一步揭示了PMC的设计优势。传统可变形卷积通过预测每个采样位置的空间偏移量$\Delta p$来改变感受野形状，其计算过程涉及偏移量预测网络、双线性插值采样等操作，计算开销较大且难以并行优化。PMC将"变形"的概念从空间域转移至参数域：不改变采样位置，而是调制采样位置对应的权重值。这种转换在保留了调制卷积行为的灵活性的同时，避免了坐标偏移和插值计算，使得PMC可以无缝嵌入标准卷积流程中，无需修改底层的卷积运算实现，具有更好的计算效率和工程实用性。

### 3.3.4 自适应路径融合门控（APFG）

全局路径输出$F_g$和局部路径输出$F_l$编码了互补的特征信息，需要通过有效的融合策略进行整合。简单的逐元素加法虽然计算高效，但忽略了两条路径在不同空间位置和不同通道维度上的相对重要性差异。例如，在地物内部区域，全局路径提供的语义一致性信息可能更为重要；而在地物边界附近，局部路径提供的细节信息则应获得更高的融合权重。

为此，本章设计了自适应路径融合门控（Adaptive Path Fusion Gate, APFG）模块，通过独立的通道级注意力分别评估两条路径特征的重要性，实现自适应的加权融合。APFG模块的结构如图3-7所示，其具体计算过程如下：

对于全局路径特征$F_g$和局部路径特征$F_l$，分别执行独立的通道注意力操作：

$$\alpha_g = \sigma(W_2^g \cdot \delta(W_1^g \cdot \text{GAP}(F_g))) \tag{3-18}$$

$$\alpha_l = \sigma(W_2^l \cdot \delta(W_1^l \cdot \text{GAP}(F_l))) \tag{3-19}$$

其中$W_1^{(\cdot)} \in \mathbb{R}^{C/r \times C}$和$W_2^{(\cdot)} \in \mathbb{R}^{C \times C/r}$分别为瓶颈结构中的降维和升维线性变换矩阵，$r$为降维比率，$\delta(\cdot)$为GeLU激活函数，$\sigma(\cdot)$为Sigmoid激活函数。两条路径使用独立的参数（上标$g$和$l$），使得各自的注意力权重能够学习到不同的通道重要性模式。

最终的融合输出通过残差连接与DropPath正则化生成：

$$Y = X + \text{DropPath}(\alpha_g \odot F_g + \alpha_l \odot F_l) \tag{3-20}$$

其中$X$为DVSS模块的原始输入特征，残差连接确保了梯度的有效回传和训练的稳定性；DropPath在训练过程中以一定概率随机跳过融合路径，起到正则化作用，增强模型的泛化能力。

值得说明的是，APFG模块中采用GeLU激活函数而非SS2D中使用的SiLU激活函数。这一选择基于对不同模块功能特性的考量：SS2D作为状态空间扫描模块，遵循原始VMamba的设计保持SiLU激活以确保架构一致性；而APFG作为融合来自异质路径（全局与局部）特征的门控模块，GeLU更平滑的梯度曲线有助于在融合过程中实现更精细的权重调节，减少异质特征混合时可能产生的梯度突变。

**图3-7 APFG模块的结构示意图。两条路径的特征分别通过独立的通道注意力进行重标定后相加融合**

## 3.4 多尺度空间核融合模块（MSK）

在编码器-解码器架构中，多尺度特征融合是弥合不同层级特征之间语义鸿沟的关键环节。浅层特征空间分辨率高、包含丰富的空间细节信息但语义抽象程度低，深层特征空间分辨率低但包含高级语义信息。有效的多尺度融合能够使各层级特征相互补充，为解码器提供兼具空间精度和语义深度的输入。

### 3.4.1 融合策略的设计考量

本章多尺度融合模块MSK的设计基于两个核心考量。第一，注意力功能的分工协作。如3.1.2节所述，DVSS模块中局部路径的ECA已经承担了通道维度的特征重标定任务。在特征融合阶段再次引入通道注意力，不仅造成计算冗余，还可能因注意力的过度施加而损害特征的多样性。因此，MSK模块专注于空间维度的注意力建模，与DVSS中的通道注意力形成互补配置。第二，多尺度融合的核心挑战。不同层级特征图之间存在的主要差异是空间分辨率和语义层级的不匹配，即空间维度的对齐与整合是融合阶段最需要关注的问题。空间注意力能够自适应地识别不同空间位置的融合重要性，在语义丰富区域和语义边界区域分配不同的关注度，有效弥合跨尺度特征之间的空间语义差距。

### 3.4.2 MSK模块结构

MSK模块的结构如图3-8所示。三个MSK模块分别在编码器的三个尺度上运作，生成增强后的跳跃连接特征$\{F_1', F_2', F_3'\}$。对于每个MSK模块，来自其他两个尺度的特征图首先通过双线性插值调整至目标分辨率，然后与目标尺度的特征沿通道维度拼接，形成包含跨尺度信息的联合特征表示。

**图3-8 MSK模块的结构示意图。三个尺度的特征经拼接和通道压缩后，通过多尺度并行卷积提取空间模式，再经空间注意力调制后恢复至目标通道数**

MSK模块的具体处理流程包含以下步骤：

**步骤一：通道压缩。** 拼接后的特征通过$1 \times 1$卷积压缩至$C/4$通道。这一压缩操作具有双重目的：降低后续多尺度卷积的计算开销，以及通过跨通道的信息混合促进不同尺度来源特征之间的初步整合：

$$F_{comp} = \text{Conv}_{1 \times 1}(\text{Cat}(F_{s_1}, F_{s_2}, F_{s_3})) \tag{3-21}$$

其中$F_{s_1}, F_{s_2}, F_{s_3}$为经尺度调整后的三层特征，$\text{Cat}(\cdot)$表示通道维度拼接。

**步骤二：多尺度空间模式提取。** 在压缩后的特征空间中，三个标准卷积以$3 \times 3$、$5 \times 5$和$7 \times 7$的核大小并行作用于$F_{comp}$，分别提取不同感受野范围内的空间模式信息，其输出进行逐元素求和：

$$F_{ms} = \text{Conv}_{3 \times 3}(F_{comp}) + \text{Conv}_{5 \times 5}(F_{comp}) + \text{Conv}_{7 \times 7}(F_{comp}) \tag{3-22}$$

采用三种不同大小的卷积核使模块能够同时感知精细的局部纹理（$3 \times 3$）、中等范围的结构模式（$5 \times 5$）和较大范围的上下文关系（$7 \times 7$）。由于所有卷积操作都在压缩后的$C/4$通道空间中进行，即便使用较大的卷积核，总体计算成本仍保持在可控范围内。

**步骤三：空间注意力调制。** 对多尺度融合特征$F_{ms}$施加空间注意力机制，自适应地突出空间维度上的关键区域。具体而言，沿通道轴分别计算平均池化和最大池化结果，将两者拼接后通过$7 \times 7$卷积和Sigmoid激活生成空间注意力图：

$$M_{spatial} = \sigma(\text{Conv}_{7 \times 7}(\text{Cat}(\text{AvgPool}(F_{ms}), \text{MaxPool}(F_{ms})))) \tag{3-23}$$

$$F_{att} = F_{ms} \odot M_{spatial} \tag{3-24}$$

平均池化捕获全局统计信息，反映各空间位置的平均响应水平；最大池化则捕获显著性信息，标识各空间位置的最强响应。两者的结合使空间注意力图兼顾了全局分布和局部显著性，能够更精确地识别需要重点关注的空间区域。

**步骤四：通道恢复。** 经空间注意力调制后的特征通过$1 \times 1$卷积恢复至目标通道数：

$$F_{out} = \text{Conv}_{1 \times 1}(F_{att}) \tag{3-25}$$

### 3.4.3 效率分析

MSK模块相较于基线方法中的MSAA模块在计算效率上实现了显著提升。以融合目标通道数$C' = 32$为例，MSAA模块同时包含通道注意力和空间注意力分支，涉及全连接层、多路径注意力计算等操作，总注意力参数量约为512。而MSK模块通过"先压缩、再处理、后恢复"的策略，将所有核心操作限定在$C/4$通道的压缩空间中进行，且仅保留空间注意力分支，注意力相关参数量降至约98，参数减少超过80%。这一效率优势在不损失分割性能的前提下，为模型在资源受限的部署场景中的实际应用提供了更大的灵活性。

## 3.5 实验结果与分析

### 3.5.1 数据集介绍

为全面评估本章所提DP-UNet方法的有效性和泛化能力，选取了三个广泛使用的公开遥感图像语义分割数据集进行实验验证。

**（1）ISPRS Potsdam数据集**

ISPRS Potsdam数据集由国际摄影测量与遥感学会发布，包含波茨坦市的高分辨率航空正射影像，地面采样距离为5厘米。数据集提供近红外、红色和绿色（NIRRG）三通道影像及对应的数字表面模型。地物标注涵盖六个类别：不透水面（Impervious surfaces）、建筑物（Building）、低矮植被（Low vegetation）、树木（Tree）、车辆（Car）和杂项（Clutter）。本章实验中，选取23幅影像用于训练（排除存在标注错误的7_10号影像），14幅影像用于测试。

**（2）ISPRS Vaihingen数据集**

ISPRS Vaihingen数据集同样由国际摄影测量与遥感学会发布，包含法伊欣根市的航空正射影像，地面采样距离为9厘米。影像为NIRRG三通道格式，地物类别标注与Potsdam数据集一致，包含六个类别。本章实验中选取12个图像块用于训练，4个图像块用于测试。Vaihingen数据集相较于Potsdam数据集，影像面积较小但地物分布更为复杂，包含更多的阴影区域和不规则建筑形态，对模型的细节捕获能力提出了更高的要求。

**（3）LoveDA数据集**

LoveDA数据集包含来自中国南京、常州和武汉三个城市的高分辨率遥感影像，地面采样距离为0.3米。该数据集涵盖城市和农村两种典型场景，标注类别为七类：背景（Background）、建筑物（Building）、道路（Road）、水体（Water）、裸地（Barren）、森林（Forest）和农田（Agriculture）。训练集包含1156幅影像，验证集包含677幅影像。LoveDA数据集的特点在于城乡场景差异显著、类别分布严重不均衡，且包含大面积的混合过渡区域，是评估模型在复杂真实场景下泛化能力的有力基准。

### 3.5.2 实验设置

本章所有实验均基于PyTorch深度学习框架实现，在单块NVIDIA RTX 3090 GPU（24GB显存）上进行训练和测试。训练阶段采用AdamW优化器，初始学习率设置为$6 \times 10^{-4}$，并采用余弦退火学习率调度策略。训练数据经过随机裁剪为$512 \times 512$像素的图像块，并施加随机缩放、随机水平翻转、随机垂直翻转、随机旋转和颜色抖动等数据增强策略以提升模型的泛化能力。测试阶段使用$1024 \times 1024$分辨率的输入，并采用测试时翻转增强以提升预测的稳定性。实验环境的详细配置信息如表3-1所示。

**表3-1 实验环境与参数配置**

| 配置项 | 详细信息 |
|---|---|
| CPU | Intel Core系列处理器 |
| GPU | NVIDIA GeForce RTX 3090（24GB） |
| 操作系统 | Ubuntu 20.04 |
| 深度学习框架 | PyTorch |
| 优化器 | AdamW |
| 初始学习率 | 6×10⁻⁴ |
| 学习率调度 | 余弦退火 |
| 训练裁剪尺寸 | 512×512 |
| 测试输入尺寸 | 1024×1024 |
| 辅助损失权重λ | 0.4 |

评价指标方面，本章采用语义分割领域广泛使用的三个标准指标：各类别F1分数的均值（mF1）、各类别交并比的均值（mIoU）和总体精度（OA）。其中，mF1综合考量了各类别的精确率和召回率，反映模型在各类别上的均衡表现；mIoU直接度量预测区域与真实区域的重叠程度，是语义分割中最核心的评价指标；OA衡量所有像素中被正确分类的比例，反映模型的整体分类准确性。

### 3.5.3 ISPRS Potsdam数据集实验结果

表3-2展示了DP-UNet与多种代表性方法在ISPRS Potsdam数据集上的定量比较结果。对比方法涵盖了基于CNN的ABCNet、基于Transformer的Segmenter和BANet、CNN-Transformer融合的UNetFormer，以及基于Mamba的CM-UNet，全面覆盖了当前遥感分割领域的主流技术路线。

**表3-2 ISPRS Potsdam数据集上的实验结果**

| 方法 | 骨干网络 | Imp.surf. | Building | Lowveg. | Tree | Car | mF1 | OA | mIoU |
|---|---|---|---|---|---|---|---|---|---|
| ABCNet | R18 | 93.28 | 95.91 | 86.78 | 87.81 | 95.49 | 91.85 | 90.51 | 85.17 |
| Segmenter | ViT-T | 91.56 | 95.38 | 85.43 | 85.01 | 88.51 | 89.27 | 88.78 | 80.71 |
| BANet | ResT-L | 93.36 | 96.70 | 87.48 | 89.11 | 96.05 | 92.55 | 91.01 | 86.36 |
| UNetFormer | R18 | 93.69 | 96.10 | 87.27 | 88.72 | 96.58 | 92.47 | 91.07 | 86.23 |
| CM-UNet | R18 | 93.62 | 96.49 | 87.42 | 88.51 | 96.09 | 92.43 | 91.04 | 86.15 |
| **DP-UNet** | **R18** | **94.10** | **96.70** | **87.78** | **89.13** | 96.09 | **92.76** | **91.57** | **86.71** |

从表3-2可以看出，DP-UNet在mF1、OA和mIoU三个综合指标上均达到了最优水平，分别为92.76%、91.57%和86.71%。在各类别的F1分数上，DP-UNet在不透水面（94.10%）和低矮植被（87.78%）类别上取得了显著的领先优势。不透水面和低矮植被是遥感图像中典型的大面积连续地物，但其内部纹理复杂且与相邻类别的边界过渡区域较为模糊，DP-UNet在这些类别上的优异表现验证了双路径解耦设计在同时保持全局一致性和边界精度方面的有效性。在建筑物类别上，DP-UNet达到96.70%，与BANet并列最优；在树木类别上达到89.13%，同样名列前茅。

值得关注的是，与采用相同ResNet-18骨干网络的对比方法（ABCNet、UNetFormer、CM-UNet）相比，DP-UNet的性能优势更为显著。在相同的特征提取条件下，DP-UNet的mIoU分别超出上述三种方法1.54%、0.48%和0.56%，这一差距直接反映了本章所提解码器设计和融合策略的有效性。

图3-9展示了DP-UNet与UNetFormer、CM-UNet在Potsdam数据集上的定性分割结果对比。从可视化结果可以观察到，在包含建筑物密集区域和不透水面-低矮植被交界区域的场景中，DP-UNet能够生成更加清晰连贯的地物边界，有效减少了边界处的错分割和漏分割现象。特别是在图3-9第一行所示的复杂城区场景中，建筑物屋顶的轮廓更加完整，低矮植被区域的分割结果更加均匀一致，体现了全局路径保障语义一致性与局部路径增强边界清晰度的协同效果。

**图3-9 ISPRS Potsdam数据集上的定性分割结果对比。（a）NIRRG原始影像；（b）UNetFormer分割结果；（c）CM-UNet分割结果；（d）DP-UNet分割结果**

### 3.5.4 ISPRS Vaihingen数据集实验结果

表3-3展示了各方法在ISPRS Vaihingen数据集上的定量比较结果。在该数据集上，DP-UNet同样取得了最优的综合性能，mF1为91.10%，OA为91.43%，mIoU为83.84%。

**表3-3 ISPRS Vaihingen数据集上的实验结果**

| 方法 | 骨干网络 | Imp.surf. | Building | Lowveg. | Tree | Car | mF1 | OA | mIoU |
|---|---|---|---|---|---|---|---|---|---|
| ABCNet | R18 | 92.72 | 95.20 | 84.55 | 89.71 | 85.35 | 89.52 | 90.78 | 81.31 |
| RS3Mamba | R18-VM-T | 93.07 | 95.70 | 85.06 | 90.94 | 88.76 | 90.67 | 91.25 | 83.13 |
| Segmenter | ViT-T | 89.84 | 93.05 | 81.23 | 88.90 | 67.66 | 84.10 | 88.17 | 73.60 |
| BANet | ResT-L | 92.22 | 95.23 | 83.81 | 89.92 | 86.82 | 89.63 | 90.52 | 81.45 |
| UNetFormer | R18 | 93.07 | 95.42 | 85.03 | 90.74 | 88.99 | 90.65 | 91.21 | 83.09 |
| CM-UNet | R18 | 93.09 | 95.75 | 85.02 | 90.70 | 89.86 | 90.89 | 91.26 | 83.49 |
| **DP-UNet** | **R18** | **93.18** | **95.88** | **85.37** | **90.84** | **90.22** | **91.10** | **91.43** | **83.84** |

在Vaihingen数据集上尤为值得关注的是车辆（Car）类别的分割性能。车辆是遥感图像中典型的小目标，其在整幅图像中仅占极小的面积比例，且形态多样、易被树冠和建筑阴影遮挡，对模型的细节捕获能力构成了严峻挑战。DP-UNet在车辆类别上达到90.22%的F1分数，超越所有对比方法。这一结果充分验证了DVSS模块中局部细节增强路径的有效性：PMC通过抑制卷积核中心主导效应，迫使网络更充分地利用邻域信息，增强了对小目标边缘和轮廓的敏感度；ECA通道注意力则帮助网络自适应地聚焦于与小目标响应相关的特征通道，减少背景干扰。两者的协同作用使得DP-UNet在小目标分割上展现出显著的优势。

图3-10展示了Vaihingen数据集上的定性分割结果对比。在包含小尺寸车辆和复杂建筑结构的区域中，DP-UNet的分割结果更加准确，车辆目标的形态更为完整，建筑物边界的分割更加规整，进一步印证了定量分析的结论。

**图3-10 ISPRS Vaihingen数据集上的定性分割结果对比。（a）NIRRG原始影像；（b）UNetFormer分割结果；（c）CM-UNet分割结果；（d）DP-UNet分割结果**

### 3.5.5 LoveDA数据集实验结果

表3-4展示了各方法在LoveDA数据集上的定量比较结果。LoveDA数据集覆盖城市与农村两种场景，类别数量多、分布严重不均衡、场景差异大，是评估模型综合能力和泛化性能的高难度基准。

**表3-4 LoveDA数据集上的实验结果**

| 方法 | 骨干网络 | Background | Building | Road | Water | Barren | Forest | Agriculture | mIoU |
|---|---|---|---|---|---|---|---|---|---|
| Segmenter | ViT-T | 38.03 | 50.74 | 48.76 | 77.40 | 13.36 | 43.48 | 58.20 | 47.18 |
| ABCNet | ViT-R50 | 53.00 | 62.18 | 52.42 | 62.02 | 29.80 | 41.61 | 47.27 | 49.80 |
| RS3Mamba | R18-VM-T | 54.01 | 57.13 | 54.62 | 61.99 | 30.64 | 38.12 | 43.41 | 48.56 |
| UNetFormer | R18 | 53.44 | 56.76 | 51.48 | 64.48 | 34.20 | 39.51 | 48.20 | 49.72 |
| CM-UNet | R18 | 55.65 | 62.70 | 53.56 | 65.73 | 34.90 | 42.17 | 54.17 | 52.84 |
| **DP-UNet** | **R18** | 54.99 | **65.61** | **55.05** | **67.83** | 32.52 | **44.70** | 51.73 | **53.21** |

DP-UNet在LoveDA数据集上取得了53.21%的mIoU，超越所有对比方法。分类别分析发现，DP-UNet在建筑物（65.61%）、道路（55.05%）、水体（67.83%）和森林（44.70%）四个类别上均达到最优，尤其在建筑物和道路这两个结构化类别上提升显著。建筑物和道路具有明确的几何结构和规则边界，它们的准确分割高度依赖于模型对全局布局模式和局部边缘细节的同步捕获能力，这恰恰是双路径解耦设计的优势所在——全局路径确保建筑群的整体结构一致性，局部路径精确刻画每个建筑和道路段的边界轮廓。

在裸地（Barren）和农田（Agriculture）类别上，DP-UNet的表现略低于CM-UNet。裸地类别面积占比极小且空间分布高度碎片化，其IoU受少量误分割像素的影响较为敏感；农田类别在城乡交界区域常与低矮植被和裸地发生混淆。这些类别的表现波动反映了LoveDA数据集固有的类别不均衡挑战，而非方法本身的结构性缺陷。

图3-11展示了LoveDA数据集上的定性分割结果对比。在城市场景中，DP-UNet对建筑物群的分割更加完整，道路的连通性更好；在城乡过渡区域，地物类别的边界划分更加合理。

**图3-11 LoveDA数据集上的定性分割结果对比。（a）原始影像；（b）UNetFormer分割结果；（c）CM-UNet分割结果；（d）DP-UNet分割结果**

### 3.5.6 消融实验

为系统评估DP-UNet各核心组件的贡献，本节在LoveDA数据集上设计了一系列消融实验，使用$1024 \times 1024$分辨率的输入图像同时评估分割精度和推理效率。实验结果如表3-5所示。

**表3-5 关键组件的消融实验结果**

| 配置 | 双路径 | APFG | 融合模块 | mIoU(%) | FPS(fps) |
|---|---|---|---|---|---|
| A (基线) | | | MSAA | 52.84 | 53.86 |
| B (移除SS2D内部注意力) | | | MSAA | 47.30 | 69.37 |
| C (引入双路径) | ✓ | | MSAA | 51.16 | 46.35 |
| C1 (引入APFG) | ✓ | ✓ | MSAA | 52.44 | 38.71 |
| **D (完整模型)** | **✓** | **✓** | **MSK** | **53.21** | **60.62** |
| E (移除ECA) | ✓ | ✓ | MSK | 47.72 | 62.38 |
| F (移除PMC) | ✓ | ✓ | MSK | 46.08 | 68.69 |

消融实验揭示了以下关键发现：

**（1）MSK模块的效率与性能优势。** 比较配置C1与配置D，将MSAA替换为MSK后，FPS从38.71提升至60.62（提升56.6%），同时mIoU从52.44%提升至53.21%（提升0.77个百分点）。这一结果有力地证明了本章所提出的精简化注意力部署策略的有效性：当解码器中已经设置了专门的局部细节增强路径时，融合阶段的纯空间注意力不仅比通道-空间双重注意力更加高效，而且因为消除了注意力冗余而实际提升了分割性能。这表明注意力机制的边际收益并非单调递增的，合理的注意力配置比注意力的简单堆叠更为重要。

**（2）双路径解耦的补偿效果。** 配置B直接移除SS2D内部注意力后，虽然FPS大幅提升至69.37，但mIoU骤降至47.30%（下降5.54个百分点），说明内部注意力门控确实承担了重要的特征增强功能。引入双路径结构和APFG融合门控后（配置C1），mIoU恢复至52.44%，几乎完全弥补了移除内部注意力造成的性能损失。这一结果表明，双路径解耦设计能够通过专门化的处理路径有效替代耦合架构中的注意力门控功能，且以更加清晰和高效的方式实现特征增强。

**（3）APFG融合优于简单加法。** 比较配置C（简单加法融合）和配置C1（APFG融合），APFG的引入使mIoU提升了1.28个百分点（从51.16%到52.44%）。这证实了全局路径和局部路径的特征在不同通道和空间位置上确实存在重要性差异，自适应的加权融合策略能够更合理地整合两条路径的互补信息。

**（4）ECA与PMC的协同必要性。** 配置E移除ECA后mIoU降至47.72%，配置F移除PMC后mIoU降至46.08%，两者均导致了严重的性能退化。值得注意的是，移除PMC造成的性能下降（7.13个百分点）甚至超过了移除ECA的影响（5.49个百分点），这表明PMC在局部细节增强中承担了核心角色。更重要的是，单独移除任一组件的性能损失都远大于两者协同工作时的边际贡献之和，揭示了ECA与PMC之间的强协同效应：ECA的通道重标定为PMC提供了经过信息筛选的高质量输入，而PMC的中心抑制机制则将ECA增强的通道信息在空间维度上进行了更充分的利用。两者缺一不可，共同构成了局部路径完整的细节增强链条。

### 3.5.7 模型复杂度分析

为综合评估DP-UNet在计算效率方面的表现，表3-6对比了各方法在LoveDA数据集上的模型复杂度指标。

**表3-6 模型复杂度对比**

| 模型 | FLOPs(G) | FPS(fps) | 参数量(M) | mIoU(%) |
|---|---|---|---|---|
| Segmenter | 26.84 | 14.78 | 48.28 | 47.18 |
| ABCNet | 123.43 | 29.36 | 13.42 | 49.80 |
| RS3Mamba | 157.88 | 24.86 | 43.32 | 48.56 |
| UNetFormer | 46.94 | 115.33 | 11.75 | 49.72 |
| CM-UNet | 48.04 | 53.86 | 12.89 | 52.84 |
| **DP-UNet** | **44.26** | **60.62** | **11.30** | **53.21** |

从表3-6可以看出，DP-UNet在性能与效率之间实现了最优的综合平衡。与基线CM-UNet相比，DP-UNet在mIoU提升0.37个百分点的同时，FLOPs降低了7.9%（从48.04G降至44.26G），参数量减少了12.3%（从12.89M降至11.30M），推理速度提升了12.5%（从53.86fps提升至60.62fps）。这一全面的效率改善正是"解耦"与"精简"双重设计原则的直接体现：双路径解耦通过专门化处理提升了每个参数的有效利用率，精简化注意力部署消除了冗余计算。

与轻量级方法UNetFormer相比，DP-UNet虽然FPS略低（60.62 vs. 115.33），但在mIoU上实现了3.49个百分点的显著提升（53.21% vs. 49.72%），且FLOPs仅有微小增加（44.26G vs. 46.94G），展现了强大的性价比优势。与高复杂度方法ABCNet和RS3Mamba相比，DP-UNet在mIoU超出前两者的同时，FLOPs仅为它们的约三分之一至四分之一，推理速度提升了两倍以上，充分证明了本章方法的设计在效率和性能方面兼具优势。

图3-12通过散点图直观展示了各方法在mIoU与FLOPs两个维度上的分布，DP-UNet位于散点图的左上方区域，即以较低的计算成本实现了较高的分割精度，进一步印证了其优越的效率-性能权衡。

**图3-12 各方法在mIoU-FLOPs平面上的分布散点图。DP-UNet位于左上方区域，表明其在保持低计算成本的同时实现了高分割精度**

## 3.6 本章小结

本章针对遥感图像语义分割中全局上下文建模与局部细节增强的耦合瓶颈以及注意力机制冗余施加的问题，提出了基于双路径解耦思想的语义分割网络DP-UNet。

具体而言，本章首先通过系统的问题分析，揭示了现有基于状态空间模型的分割方法中存在的两个共性问题：全局-局部建模的耦合效应导致两个子任务无法各自达到最优，以及多阶段同质注意力的重复施加带来的计算冗余与注意力过度聚焦现象。基于上述分析，本章提出了双路径解耦状态空间模块（DVSS），将全局上下文保持和局部细节增强分离至两条独立路径中。全局路径直接保留状态空间扫描的全局语义表示，局部路径则通过ECA通道注意力进行特征筛选后，利用PMC参数域调制卷积抑制标准卷积的中心主导效应，增强对边缘和纹理等局部细节的捕获能力。两条路径的输出通过APFG自适应路径融合门控进行加权整合。在多尺度特征融合阶段，本章提出了轻量级的MSK模块，以纯空间注意力取代冗余的通道-空间双重注意力，在压缩通道空间中完成多尺度空间模式提取与空间注意力调制，实现了注意力参数80%以上的压缩。

在ISPRS Potsdam、ISPRS Vaihingen和LoveDA三个公开遥感分割数据集上的广泛实验表明，DP-UNet在mIoU指标上分别达到86.71%、83.84%和53.21%，全面超越了包括CNN方法、Transformer方法和Mamba方法在内的多种代表性方法。消融实验验证了各核心组件的有效性及其协同效应，模型复杂度分析表明DP-UNet在提升分割精度的同时，实现了FLOPs降低7.9%、参数量减少12.3%和推理速度提升12.5%的全面效率改善。

尽管DP-UNet在单模态遥感图像分割上取得了优异的性能，但实际遥感应用中往往需要融合来自不同传感器的多模态数据以获取更全面的地物信息。例如，光学影像提供丰富的光谱和纹理信息，而合成孔径雷达（SAR）影像则具有全天候全天时成像能力并能反映地表的介电特性和结构信息。如何将本章所提出的核心设计思想——双路径解耦与精简化注意力——有效地扩展至多模态融合场景，是下一章将要探讨的问题。
