、import numpy as np
from PIL import Image
import os
from DataSet import WHU_OPT_SARDataset
from torch.utils.data import DataLoader

# 方法1：直接读取标签文件
def check_labels_direct():
    print("=== 直接检查标签文件 ===")
    label_dir = 'dataset/train/lbl'  # 修改为您的路径
    
    all_unique_values = set()
    
    # 检查前5个文件
    for i, filename in enumerate(os.listdir(label_dir)[:5]):
        if filename.endswith(('.png', '.tif', '.jpg')):
            label_path = os.path.join(label_dir, filename)
            label = Image.open(label_path).convert('L')
            label_array = np.array(label)
            
            unique_values = np.unique(label_array)
            all_unique_values.update(unique_values)
            
            print(f"\n文件 {filename}:")
            print(f"  标签范围: {unique_values}")
            print(f"  最小值: {label_array.min()}, 最大值: {label_array.max()}")
            print(f"  各标签像素数量:")
            for val in unique_values:
                count = (label_array == val).sum()
                print(f"    标签 {val}: {count} 像素")
    
    print(f"\n所有文件的标签值: {sorted(all_unique_values)}")

# 方法2：通过数据集类检查
def check_labels_dataset():
    print("\n=== 通过数据集类检查 ===")
    dataset = WHU_OPT_SARDataset(
        class_name='whu-sar-opt',
        root='dataset/train'  # 修改为您的路径
    )
    
    all_unique_values = set()
    
    # 检查前5个样本
    for i in range(min(5, len(dataset))):
        sar, opt, mask = dataset[i]
        
        # 转换为numpy查看
        mask_np = mask.numpy()
        unique_values = np.unique(mask_np)
        all_unique_values.update(unique_values.tolist())
        
        print(f"\n样本 {i}:")
        print(f"  标签shape: {mask_np.shape}")
        print(f"  标签范围: {unique_values}")
        print(f"  最小值: {mask_np.min()}, 最大值: {mask_np.max()}")
    
    print(f"\n数据集中所有标签值: {sorted(all_unique_values)}")

# 运行检查
if __name__ == "__main__":
    # 先直接检查原始文件
    check_labels_direct()
    
    # 再通过数据集类检查
    check_labels_dataset()
